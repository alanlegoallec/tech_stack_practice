services:
  backend-app:
    entrypoint: [] # Neutralize Dockerfile startup so we can manually run the debugger
    env_file:
      - .env
    environment:
      - DEBUG_INTERNAL=true # Set the DEBUG_INTERNAL environment variable for internal debug mode
    command:
      [
        "bash",
        "-c",
        'if [ "$DEBUG_INTERNAL" = "true" ]; then sh /app/scripts/install-vscode-extensions.sh; fi && tail -f /dev/null',
      ]
    ports:
      - "${HOST_API_PORT_DEBUG}:${CONTAINER_API_PORT}" # Port for backend API (different port to avoid conflict with prod)
      - "${HOST_API_VSCODE_DEBUGGER_PORT}:${CONTAINER_API_PYTHON_DEBUGGER_PORT}" # Debugger port for VSCode
    profiles: ["debug-internal"]

  frontend-app:
    entrypoint: [] # Neutralize Dockerfile startup so we can manually run the debugger
    env_file:
      - .env
    environment:
      - DEBUG_INTERNAL=true # Set the DEBUG_INTERNAL environment variable for internal debug mode
    command:
      [
        "bash",
        "-c",
        'if [ "$DEBUG_INTERNAL" = "true" ]; then sh /app/scripts/install-vscode-extensions.sh; fi && tail -f /dev/null',
      ]
    ports:
      - "${HOST_STREAMLIT_PORT_DEBUG}:${CONTAINER_STREAMLIT_PORT}" # Map port for frontend Streamlit app (different port to avoid conflict with prod)
      - "${HOST_STREAMLIT_VSCODE_DEBUGGER_PORT}:${CONTAINER_STREAMLIT_PYTHON_DEBUGGER_PORT}" # Debugger port for frontend
    profiles: ["debug-internal"]
